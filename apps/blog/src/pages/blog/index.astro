---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import PagefindSearch from '../../components/PagefindSearch.astro';

const posts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
---
<BaseLayout
  title="Blog â€“ alexandersumer.com"
  description="Writing about software, systems, and learning"
  canonical="/blog/"
>
  <section class="prose dark:prose-invert">
    <h1>Blog</h1>
    <p>Browse every post by Alexander Sumer.</p>
  </section>

  {posts.length > 5 && <PagefindSearch />}

  <ul class="divide-y divide-black/10 dark:divide-white/10 not-prose">
    {posts.map(({ slug, data }) => (
      <li class="py-6">
        <a href={`/blog/${slug}/`} class="text-xl font-semibold text-[oklch(var(--fg))] hover:underline">
          {data.title}
        </a>
        <div class="text-sm opacity-70">
          {data.pubDate.toLocaleDateString(undefined, {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
          })}
        </div>
        <p class="mt-2 opacity-80">{data.description}</p>
      </li>
    ))}
  </ul>
</BaseLayout>
