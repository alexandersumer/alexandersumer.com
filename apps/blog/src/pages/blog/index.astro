---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PagefindSearch from '../../components/PagefindSearch.astro';
import { integrations } from '../../config/integrations';
import { siteConfig } from '../../config/site';
import { getPublishedPosts } from '../../lib/posts';

const posts = await getPublishedPosts();
const { pagefind } = integrations;
---
<BaseLayout
  title={`Blog â€“ ${siteConfig.site.name}`}
  description={siteConfig.site.tagline}
  canonical="/blog/"
>
  <section class="prose dark:prose-invert">
    <h1>Blog</h1>
    <p>Browse every post by Alexander Sumer.</p>
  </section>

  {pagefind.enabled && posts.length >= pagefind.minItems && <PagefindSearch config={pagefind} />}

  <ul class="divide-y divide-black/10 dark:divide-white/10 not-prose">
    {posts.map(({ slug, data }) => (
      <li class="py-6">
        <a href={`/blog/${slug}/`} class="text-xl font-semibold text-[oklch(var(--fg))] hover:underline">
          {data.title}
        </a>
        <div class="text-sm opacity-70">
          {data.pubDate.toLocaleDateString(undefined, {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
          })}
        </div>
        <p class="mt-2 opacity-80">{data.description}</p>
      </li>
    ))}
  </ul>
</BaseLayout>
